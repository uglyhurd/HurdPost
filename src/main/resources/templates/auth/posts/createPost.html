<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–æ–∑–¥–∞—Ç—å –ø–æ—Å—Ç | HurdPost</title>
    <link rel="stylesheet" href="/style/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Anybody:wght@300;400;600;700&family=Geologica:wght@300;400;500;600&display=swap" rel="stylesheet">
</head>
<body class="create-post-page">
<!-- Header -->
<header class="main-header">
    <div class="header-container">
        <div class="header-left">
            <a href="/posts" class="back-link">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                    <path d="M15 18l-6-6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
            </a>
            <h1 class="logo-text">HurdPost</h1>
        </div>

        <div class="header-right">
            <div class="user-menu">
                <button class="user-avatar">
                    <img th:src="@{/images/profile.png}" alt="User" width="40" height="40">
                </button>
                <div class="user-dropdown">
                    <div class="dropdown-header">
                        <p class="user-name" th:text="${user.name}">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</p>
                        <p class="user-username" th:text="'@' + ${user.username}">@username</p>
                    </div>
                    <div class="dropdown-divider"></div>
                    <a th:href="@{/myProfile/{id}(id=${user.getId()})}" class="dropdown-item">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                            <circle cx="10" cy="7" r="3" stroke="currentColor" stroke-width="2"/>
                            <path d="M4 18c0-3.314 2.686-6 6-6s6 2.686 6 6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        –ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å
                    </a>
                    <a href="#" class="dropdown-item">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                            <circle cx="10" cy="10" r="7" stroke="currentColor" stroke-width="2"/>
                            <path d="M10 6v4l3 2" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        –ù–∞—Å—Ç—Ä–æ–π–∫–∏
                    </a>
                    <div class="dropdown-divider"></div>
                    <a href="/logout" class="dropdown-item danger">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                            <path d="M13 16l4-4-4-4M17 12H9M9 2H5a2 2 0 00-2 2v12a2 2 0 002 2h4" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        –í—ã–π—Ç–∏
                    </a>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Main content -->
<main class="create-post-main">
    <div class="create-post-container">
        <div class="create-post-card">
            <div class="create-post-header">
                <h2>–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –ø–æ—Å—Ç</h2>
                <p class="create-post-subtitle">–ü–æ–¥–µ–ª–∏—Ç–µ—Å—å —Å–≤–æ–∏–º–∏ –º—ã—Å–ª—è–º–∏ —Å –º–∏—Ä–æ–º</p>
            </div>

            <form th:action="@{/createPost/getPost}" th:method="POST" th:object="${post}" enctype="multipart/form-data" class="create-post-form">
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">

                <div class="post-author-info">
                    <img th:src="@{/images/profile.png}" alt="User" class="author-avatar">
                    <div class="author-details">
                        <p class="author-name" th:text="${user.name}">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</p>
                        <p class="author-username" th:text="'@' + ${user.username}">@username</p>
                    </div>
                </div>

                <!-- Content textarea -->
                <div class="form-group-post">
                    <label for="content" class="form-label-hidden">–°–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø–æ—Å—Ç–∞</label>
                    <textarea
                            id="content"
                            th:field="*{content}"
                            class="post-textarea"
                            placeholder="–û —á–µ–º –≤—ã –¥—É–º–∞–µ—Ç–µ?"
                            rows="8"
                            required
                    ></textarea>
                    <div class="char-counter">
                        <span id="charCount">0</span> / 5000
                    </div>
                    <div th:if="${#fields.hasErrors('content')}" class="field-error">
                        <span th:errors="*{content}"></span>
                    </div>
                </div>

                <!-- Media upload section -->
                <div class="media-upload-section">
                    <div class="upload-tabs">
                        <button type="button" class="upload-tab active" data-tab="image">
                            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                <rect x="2" y="2" width="16" height="16" rx="2" stroke="currentColor" stroke-width="2"/>
                                <circle cx="7" cy="7" r="2" stroke="currentColor" stroke-width="2"/>
                                <path d="M18 13l-4-4-6 6-2-2-4 4" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                            </svg>
                            –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                        </button>
                        <button type="button" class="upload-tab" data-tab="video">
                            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                <rect x="2" y="3" width="12" height="14" rx="2" stroke="currentColor" stroke-width="2"/>
                                <path d="M14 7l4-2v10l-4-2" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                            </svg>
                            –í–∏–¥–µ–æ
                        </button>
                    </div>

                    <!-- Image upload -->
                    <div class="upload-content active" id="image-upload">
                        <div class="form-group-post">
                            <label for="image_url" class="upload-label">
                                <div class="upload-box" id="imageUploadBox">
                                    <svg width="48" height="48" viewBox="0 0 48 48" fill="none" class="upload-icon">
                                        <rect x="6" y="6" width="36" height="36" rx="4" stroke="currentColor" stroke-width="3"/>
                                        <circle cx="16" cy="16" r="4" stroke="currentColor" stroke-width="3"/>
                                        <path d="M42 30l-10-10-14 14-6-6-6 6" stroke="currentColor" stroke-width="3" stroke-linecap="round"/>
                                    </svg>
                                    <p class="upload-text">–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</p>
                                    <p class="upload-hint">PNG, JPG, GIF –¥–æ 10MB</p>
                                </div>
                                <input
                                        type="file"
                                        id="image_url"
                                        name="imageFile"
                                        accept="image/*"
                                        class="file-input"
                                        onchange="previewImage(event)"
                                >
                            </label>
                            <div id="imagePreview" class="media-preview" style="display: none;">
                                <img id="imagePreviewImg" src="" alt="Preview">
                                <button type="button" class="remove-media" onclick="removeImage()">
                                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                        <path d="M15 5L5 15M5 5l10 10" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Video upload -->
                    <div class="upload-content" id="video-upload">
                        <div class="form-group-post">
                            <label for="video_url" class="upload-label">
                                <div class="upload-box" id="videoUploadBox">
                                    <svg width="48" height="48" viewBox="0 0 48 48" fill="none" class="upload-icon">
                                        <rect x="6" y="8" width="28" height="32" rx="4" stroke="currentColor" stroke-width="3"/>
                                        <path d="M34 14l8-4v28l-8-4" stroke="currentColor" stroke-width="3" stroke-linecap="round"/>
                                        <circle cx="20" cy="24" r="6" stroke="currentColor" stroke-width="3"/>
                                    </svg>
                                    <p class="upload-text">–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∏–¥–µ–æ</p>
                                    <p class="upload-hint">MP4, AVI, MOV –¥–æ 50MB</p>
                                </div>
                                <input
                                        type="file"
                                        id="video_url"
                                        name="videoFile"
                                        accept="video/*"
                                        class="file-input"
                                        onchange="previewVideo(event)"
                                >
                            </label>
                            <div id="videoPreview" class="media-preview" style="display: none;">
                                <video id="videoPreviewElement" controls></video>
                                <button type="button" class="remove-media" onclick="removeVideo()">
                                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                        <path d="M15 5L5 15M5 5l10 10" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Error messages -->
                <div th:if="${param.error}" class="error-message">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <circle cx="10" cy="10" r="9" stroke="currentColor" stroke-width="2"/>
                        <path d="M10 6V10M10 14H10.01" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                    <p>–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–æ—Å—Ç–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.</p>
                </div>

                <!-- Form actions -->
                <div class="form-actions">
                    <a href="/posts" class="btn btn-outline btn-cancel">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                            <path d="M15 5L5 15M5 5l10 10" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        –û—Ç–º–µ–Ω–∞
                    </a>
                    <button type="submit" class="btn btn-primary btn-submit">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                            <path d="M18 2L9 11M18 2l-6 16-3-7-7-3 16-6z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å
                        <span class="btn-arrow">‚Üí</span>
                    </button>
                </div>
            </form>
        </div>

        <!-- Tips sidebar -->
        <aside class="tips-sidebar">
            <div class="tips-card">
                <h3>üí° –°–æ–≤–µ—Ç—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ—Å—Ç–∞</h3>
                <ul class="tips-list">
                    <li>
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                            <path d="M13 4L6 11L3 8" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        –ë—É–¥—å—Ç–µ –∏—Å–∫—Ä–µ–Ω–Ω–∏ –∏ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã
                    </li>
                    <li>
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                            <path d="M13 4L6 11L3 8" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
                    </li>
                    <li>
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                            <path d="M13 4L6 11L3 8" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        –î–æ–±–∞–≤—å—Ç–µ —Ö—ç—à—Ç–µ–≥–∏ –¥–ª—è –ø–æ–∏—Å–∫–∞
                    </li>
                    <li>
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                            <path d="M13 4L6 11L3 8" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–µ–∫—Å—Ç –ø–µ—Ä–µ–¥ –ø—É–±–ª–∏–∫–∞—Ü–∏–µ–π
                    </li>
                </ul>
            </div>

            <div class="tips-card preview-card">
                <h3>üëÅÔ∏è –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä</h3>
                <div class="post-preview">
                    <div class="preview-author">
                        <img th:src="@{/images/profile.png}" alt="User" class="preview-avatar">
                        <div>
                            <p class="preview-name" th:text="${user.name}">–ò–º—è</p>
                            <p class="preview-time">–¢–æ–ª—å–∫–æ —á—Ç–æ</p>
                        </div>
                    </div>
                    <p class="preview-content" id="previewContent">–í–∞—à –ø–æ—Å—Ç –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å...</p>
                    <div id="previewMedia" class="preview-media-container"></div>
                </div>
            </div>
        </aside>
    </div>
</main>

<script>
    // Character counter
    const textarea = document.getElementById('content');
    const charCount = document.getElementById('charCount');
    const previewContent = document.getElementById('previewContent');

    textarea.addEventListener('input', function() {
        const count = this.value.length;
        charCount.textContent = count;

        // Update preview
        if (this.value.trim()) {
            previewContent.textContent = this.value;
        } else {
            previewContent.textContent = '–í–∞—à –ø–æ—Å—Ç –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å...';
        }

        // Color change based on limit
        if (count > 4500) {
            charCount.style.color = 'var(--color-error)';
        } else if (count > 4000) {
            charCount.style.color = 'var(--color-warning)';
        } else {
            charCount.style.color = 'var(--color-gray-600)';
        }
    });

    // Tab switching
    const uploadTabs = document.querySelectorAll('.upload-tab');
    const uploadContents = document.querySelectorAll('.upload-content');

    uploadTabs.forEach(tab => {
        tab.addEventListener('click', function() {
            const targetTab = this.dataset.tab;

            // Remove active class from all tabs
            uploadTabs.forEach(t => t.classList.remove('active'));
            uploadContents.forEach(c => c.classList.remove('active'));

            // Add active class to clicked tab
            this.classList.add('active');
            document.getElementById(targetTab + '-upload').classList.add('active');
        });
    });

    // Image preview
    function previewImage(event) {
        const file = event.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('imagePreviewImg').src = e.target.result;
                document.getElementById('imagePreview').style.display = 'block';
                document.getElementById('imageUploadBox').style.display = 'none';

                // Update preview sidebar
                const previewMedia = document.getElementById('previewMedia');
                previewMedia.innerHTML = `<img src="${e.target.result}" alt="Preview" style="width: 100%; border-radius: var(--radius-lg); margin-top: var(--space-sm);">`;
            }
            reader.readAsDataURL(file);
        }
    }

    function removeImage() {
        document.getElementById('image_url').value = '';
        document.getElementById('imagePreview').style.display = 'none';
        document.getElementById('imageUploadBox').style.display = 'flex';
        document.getElementById('previewMedia').innerHTML = '';
    }

    // Video preview
    function previewVideo(event) {
        const file = event.target.files[0];
        if (file) {
            const url = URL.createObjectURL(file);
            document.getElementById('videoPreviewElement').src = url;
            document.getElementById('videoPreview').style.display = 'block';
            document.getElementById('videoUploadBox').style.display = 'none';

            // Update preview sidebar
            const previewMedia = document.getElementById('previewMedia');
            previewMedia.innerHTML = `<video src="${url}" controls style="width: 100%; border-radius: var(--radius-lg); margin-top: var(--space-sm);"></video>`;
        }
    }

    function removeVideo() {
        document.getElementById('video_url').value = '';
        document.getElementById('videoPreview').style.display = 'none';
        document.getElementById('videoUploadBox').style.display = 'flex';
        document.getElementById('previewMedia').innerHTML = '';

        const videoElement = document.getElementById('videoPreviewElement');
        videoElement.pause();
        videoElement.src = '';
    }

    // User menu dropdown
    document.querySelector('.user-avatar').addEventListener('click', function() {
        document.querySelector('.user-dropdown').classList.toggle('show');
    });

    // Close dropdown when clicking outside
    document.addEventListener('click', function(e) {
        if (!e.target.closest('.user-menu')) {
            document.querySelector('.user-dropdown').classList.remove('show');
        }
    });

    // Form submission animation
    document.querySelector('.create-post-form').addEventListener('submit', function(e) {
        const submitBtn = document.querySelector('.btn-submit');
        submitBtn.disabled = true;
        submitBtn.innerHTML = `
                <svg width="20" height="20" viewBox="0 0 20 20" fill="none" style="animation: spin 1s linear infinite;">
                    <circle cx="10" cy="10" r="7" stroke="currentColor" stroke-width="2" opacity="0.3"/>
                    <path d="M10 3a7 7 0 017 7" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
                –ü—É–±–ª–∏–∫–∞—Ü–∏—è...
            `;
    });
</script>

<style>
    @keyframes spin {
        to { transform: rotate(360deg); }
    }
</style>
</body>
</html>